version: "3.8"

services:
  upstream:
    build:
      context: .
      dockerfile: Dockerfile.upstream
    restart: unless-stopped
    networks:
      dns_net:
        ipv4_address: 10.0.0.100

  resolver:
    image: mvance/unbound:latest
    restart: unless-stopped
    depends_on:
      - upstream
    volumes:
      - ./unbound.conf:/opt/unbound/etc/unbound/unbound.conf:ro
    ports:
      - "5053:53/udp"
      - "5053:53/tcp"
    networks:
      dns_net:
        ipv4_address: 10.0.0.53

  bot:
    build:
      context: .
      dockerfile: Dockerfile.bot
    restart: unless-stopped
    depends_on:
      - resolver
    environment:
      - CANDIDATES=charlie-payroll.internal,charlie-vpn.internal,charlie-hr.internal,alice-payroll.internal,alice-vpn.internal,bob-payroll.internal,bob-hr.internal,daniela-payroll.internal,daniela-vpn.internal
      - DEBUG=1
    networks:
      - dns_net

networks:
  dns_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.0.0.0/24
